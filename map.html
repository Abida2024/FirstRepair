<!DOCTYPE html>
<html>
    <title> Reparations Legislation </title>
    <head>
        <!-- Plotly.js -->
        <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    </head>
    <p>
        The following map was created using plotly.js, please feel free to play around with other styles!
        <a href="https://bit.ly/1Or9igj">plotly.js documentation</a>
    </p>
    <!-- Create an empty div in which to draw the graph "-->
    <div id="mapFP" style="width:200%;height:750px">
    </div>
</html>

<script type = "module"> 
    import * as d3 from "https://cdn.jsdelivr.net/npm/d3@7/+esm";
    var data = [{
        type: 'scattergeo',
        mode: 'markers+text',
        text: [
            'Evanston', 
        ],
        lon: [
            -87.68,
        ],
        lat: [
            42.05,
        ],
        marker: {
            size: 7,
            color: [
                '#0ff',
            ],
            line: {
                width: 1,
            }
        },
        name: 'Map of US Cities that have passed legislative actions wrt reparations',
        textposition: [
            'top right',
        ],
    }];

    d3.csv("datapoints.csv").then((data2) => {
        // Iterate through each of the rows in the csv file
        // Append to data latitude and longitude  
        data2.map((d) =>{
            d['Latitude'] === '' ? "" : data[0].lat.push(+d['Latitude']);
            d['Longitude'] === '' ? "": data[0].lon.push(-1*+d['Longitude']);
            d['Latitude'] === '' ? "": data[0].text.push(d['State ']);
            
            
            //Stage column refers to which stage of legislative process an action is in. 'd' indicates discussion, 'p' indicates legislation is proposed
            //and working its way through state/local govt process, 'a' indicates passed legistlation, 'n' indicates non-govt entity
            if (d['Latitude'] === '')  {
                "";
            } else if (d['Stage'] == 'a') {
                data[0].marker.color.push('#f00');
            } else if (d['Stage'] == 'p') {
                data[0].marker.color.push('#0ff')
            } else if (d['Stage'] == 'd') {
                data[0].marker.color.push('#0f0')
            } else {
                data[0].marker.color.push('#000')
            };
            //d['Latitude'] === '' ? "": data[0].marker.color.push('#0ff');
            d['Latitude'] === '' ? "": data[0].textposition.push('top right')});
        console.log(data);
        Plotly.newPlot('mapFP', data, layout);
    });

    //d3.csv()


    console.log(data); 
    console.log(data); 
    
    var layout = {
        title: 'Map of US Cities',
        font: {
            family: 'Droid Serif, serif',
            size: 6
        },
        titlefont: {
            size: 16
        },
        geo: {
            scope: 'north america',
            resolution: 50,
            lonaxis: {
                'range': [-130, -55]
            },
            lataxis: {
                'range': [40, 70]
            },
            showrivers: false,
            showlakes: true,
            lakecolor: '#fff',
            showland: true,
            landcolor: '#fff',
            countrycolor: '#d3d3d3',
            countrywidth: 1.5,
            subunitcolor: '#d3d3d3'
        }
    };

    //Plotly.newPlot('mapFP', data, layout);
    console.log(data);

</script>

